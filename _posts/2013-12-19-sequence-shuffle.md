---
layout: post
category: db
tags: db perl
title: シーケンスをシャッフルする君1号
---
{% include JB/setup %}

つい先日、外部参照する id を勘違いして、全然違うテーブルの id で結合するという大チョンボをやらかしまして。。。

タチが悪いのが、正解だったテーブルもハズレのテーブルもほぼ同じペースでシーケンスが増えていくので、
間違いになかなか気づかない。ってかステージングではバグが出てるんだけど、開発だと再現しなくて、
「なんじゃこりゃー」って感じで大変悩みました。

んで、これやばいので、対策しようと思いまして、id は大体シーケンスになっているので、シーケンスが全然違う
番号になっていれば、もし間違ってもすぐに気づくだろう、と思ってシーケンスをずらす物体を作ってみた。

<script src="https://gist.github.com/tsucchi/8035822.js"></script>

ポスグレ限定です。
対策もコードも、もっといいやり方ありそうな気がしてるけど、まあこんなもんかなぁ。。。
